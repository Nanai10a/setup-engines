name: setup-engines
description: setup engines in package.json automatically

runs:
  using: "composite"
  steps:
    - id: json
      run: echo "txt=$(cat package.json | jq -c '.engines')" >> $GITHUB_OUTPUT

    - id: engines
      run: |
        echo "node=${{ fromJSON(steps.json.outputs.txt).node }}" >> $GITHUB_OUTPUT
        echo "yarn=${{ fromJSON(steps.json.outputs.txt).yarn }}" >> $GITHUB_OUTPUT
        echo "pnpm=${{ fromJSON(steps.json.outputs.txt).pnpm }}" >> $GITHUB_OUTPUT

    - name: setup node
      if: steps.engines.outputs.node != ''
      uses: actions/setup-node@v3
      with:
        node-version: ${{ steps.engines.outputs.node }}

    - name: setup yarn
      if: steps.engines.outputs.yarn != ''
      run: corepack prepare ${{ steps.engines.outputs.yarn }} --activate

    - name: setup pnpm
      if: steps.engines.outputs.pnpm != ''
      run: corepack prepare ${{ steps.engines.outputs.pnpm }} --activate
